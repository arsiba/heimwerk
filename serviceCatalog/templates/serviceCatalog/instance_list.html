{% extends "base_generic.html" %}

{% block content %}
  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h3 mb-0">Your Deployments</h2>
    </div>

    {% if owned_Instances %}
      <div class="row g-4">
        {% for instance in owned_Instances %}
          <div class="col-md-6 col-xl-4">
            <div class="card h-100 shadow-sm border-0">
              <div class="card-body d-flex flex-column">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h5 class="card-title mb-0 fw-bold text-primary">
                    {{ instance.name|default:"Unnamed Module" }}
                  </h5>
                  <span class="badge
                               {% if instance.status == 'active' %}bg-success
                               {% elif instance.status == 'error' %}bg-danger
                               {% elif instance.status == 'pending' %}bg-warning text-dark
                               {% else %}bg-secondary
                               {% endif %}">
                    {{ instance.status|default:"Unknown" }}
                  </span>
                </div>

                <!-- Metadata -->
                <ul class="list-unstyled small text-muted mb-4">
                  <li><i class="bi bi-person me-2"></i><strong>Owner:</strong> {{ instance.owner|default:"Unknown" }}</li>
                  <li><i class="bi bi-calendar-plus me-2"></i><strong>Created:</strong> {{ instance.created_at|default:"N/A" }}</li>
                  <li><i class="bi bi-calendar-check me-2"></i><strong>Updated:</strong> {{ instance.updated_at|default:"N/A" }}</li>
                  <li><i class="bi bi-box me-2"></i><strong>Module:</strong> {{ instance.module|default:"N/A" }}</li>
                </ul>

                <!-- Terraform Output -->
                <div class="bg-light border rounded p-3 mb-3 flex-grow-1">
                  <h6 class="text-secondary fw-semibold mb-2">Terraform Output</h6>
                  <pre class="small text-muted mb-0" style="white-space: pre-wrap;">{{ instance.terraform_output|default:"No output available." }}</pre>
                </div>

                <!-- Actions -->
                <div class="border-top pt-3 mt-auto d-flex gap-2">
                  <a href="#" class="btn btn-outline-primary btn-sm w-100">Manage</a>
                  <a href="{{ instance.get_absolute_url }}" class="btn btn-outline-secondary btn-sm w-100">Details</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-warning border-warning" role="alert">
        <h5 class="alert-heading mb-1">No Deployments Found</h5>
        <p class="mb-0">You havenâ€™t deployed any modules yet. Browse the catalog to get started.</p>
      </div>
    {% endif %}
  </div>
{% endblock %}
